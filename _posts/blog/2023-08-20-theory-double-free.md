---
title: Double Free Bug 취약점과 예시
categories: [Hacking, Theory]
tags: [Hacking, System hacking]
date: 2023-08-20 23:08:00 +0900
---
Double Free Bug는 프로그램에서 동일한 메모리 영역을 두 번 이상 해제(free)하는 경우에 발생하는 보안 취약점입니다. 이번 글에서는 Double Free Bug의 개념을 자세히 설명하고, 실제 예시를 통해 그 작동 원리와 방지 방법을 알아보겠습니다.

## Double Free Bug란?

Double Free Bug는 주로 동적 메모리 할당과 관련된 프로그램에서 발생하는 문제입니다. 프로그램이 동일한 메모리 영역을 두 번 이상 해제하려고 할 때, 이중으로 해제하면서 메모리 관리 오류가 발생하는 것을 의미합니다. 이로 인해 프로그램이 예측할 수 없는 동작을 하거나 크래시가 발생할 수 있으며, 악의적인 공격으로 이어질 수도 있습니다.

## Double Free Bug 예시

가정해보겠습니다. 아래의 C 코드는 사용자의 입력을 받아들이고, 입력된 문자열을 처리하는 프로그램입니다.

```c
#include <stdio.h>
#include <stdlib.h>

int main() {
    char *data = (char *)malloc(100);

    printf("데이터를 입력하세요: ");
    scanf("%s", data);

    free(data); // 첫 번째 해제

    // ...

    free(data); // 두 번째 해제

    return 0;
}
```

이 코드에서는 `data`라는 문자열 포인터를 동적으로 할당하고 사용자 입력을 받아 이를 저장한 뒤, `free` 함수를 사용하여 `data`를 해제합니다. 그런데 이미 해제된 `data`를 다시 한 번 해제하려고 한다면 어떻게 될까요?

두 번째 `free(data)`에서는 이미 해제된 메모리를 다시 해제하려고 하기 때문에 프로그램이 예측할 수 없는 동작을 하거나 크래시가 발생할 수 있습니다. 이 경우, 이중 해제로 인한 메모리 관리 오류가 발생하게 됩니다.

## Double Free Bug 방지 방법

Double Free Bug를 방지하기 위해서는 다음과 같은 방법을 고려해야 합니다.

1. **NULL 포인터 할당**: 메모리를 해제한 후 해당 포인터를 NULL로 설정하여, 중복 해제 시도를 막을 수 있습니다.

2. **동적 분석 도구 사용**: 정적 분석 및 동적 분석 도구를 사용하여 Double Free Bug를 탐지하고 수정하는데 도움을 받을 수 있습니다.

3. **메모리 관리 철저**: 메모리 할당과 해제를 꼼꼼하게 관리하고, 중복 해제를 방지하는 로직을 추가해야 합니다.

## 결론

Double Free Bug는 메모리 관리 오류로 인해 발생할 수 있는 심각한 보안 취약점입니다. 프로그램에서 메모리 할당과 해제를 정확하게 관리하고, 중복 해제를 방지하는 방법을 사용하여 이러한 취약점을 예방해야 합니다. 안정적인 메모리 관리를 통해 시스템과 사용자 데이터를 보호하며, 보안 문제를 방지할 수 있습니다.
